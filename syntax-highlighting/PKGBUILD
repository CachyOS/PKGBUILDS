# Maintainer: pavbaranov <pavbaranov at gmail dot com>
# only for version with bugfixes from upcomming releases
# based on the original works by:
# Maintainer: Antonio Rojas <arojas@archlinux.org>
# Maintainer: Felix Yan <felixonmars@archlinux.org>

pkgname=syntax-highlighting
pkgver=5.78.0
pkgrel=1.1
pkgdesc='Syntax highlighting engine for structured text and code'
arch=(x86_64)
url='https://community.kde.org/Frameworks'
license=(GPL2)
depends=(qt5-base)
makedepends=(extra-cmake-modules qt5-xmlpatterns qt5-tools qt5-doc doxygen)
groups=(kf5)
source=("https://download.kde.org/stable/frameworks/${pkgver%.*}/$pkgname-$pkgver.tar.xz"{,.sig}
kdebug-425345.patch::"https://invent.kde.org/frameworks/syntax-highlighting/commit/90626bde463eca70a448579c7d6493546263152e.patch"
#kdebug-430668.patch::"https://invent.kde.org/frameworks/syntax-highlighting/commit/04e16355f52fc83ffa5821890d91009e26d6da99.patch"
)
sha256sums=('8b5eb71ce548bb2267235db42d026d8655285396cfc2766e0277c8688d7bd6d4'
            'SKIP'
            '4c8589c25a2ac9f13c7f12aa61b8344fc76c5b665f3c95c61319673f15827d37')
validpgpkeys=(53E6B47B45CEA3E0D5B7457758D0EE648A48B3BB) # David Faure <faure@kde.org>

prepare() {
    msg "Add kdebug 425345 patch"
    patch -d $pkgname-$pkgver -p1 -i ../kdebug-425345.patch
 #   msg "Add kdebug 430668 patch"
 #   patch -d $pkgname-$pkgver -p1 -i ../kdebug-430668.patch
}

build() {
  cmake -B build -S $pkgname-$pkgver \
    -DBUILD_TESTING=OFF \
    -DQRC_SYNTAX=OFF \
    -DBUILD_QCH=ON
  cmake --build build
}

package() {
  DESTDIR="$pkgdir" cmake --install build
}
