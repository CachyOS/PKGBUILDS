From 9ab5a5c6f8ba7daf8467ab2cc52177827f2104f3 Mon Sep 17 00:00:00 2001
From: Laurent Montel <montel@kde.org>
Date: Wed, 21 Nov 2018 07:53:24 +0100
Subject: Parent action/widget so when we close asan will not report potential
 mem

leak
---
 src/Gui/KSMainWindow.cpp | 28 +++++++++++++++-------------
 1 file changed, 15 insertions(+), 13 deletions(-)

diff --git a/src/Gui/KSMainWindow.cpp b/src/Gui/KSMainWindow.cpp
index 33795ed..747406e 100644
--- a/src/Gui/KSMainWindow.cpp
+++ b/src/Gui/KSMainWindow.cpp
@@ -51,20 +51,20 @@ static const int MAXIMUM_WINDOW_WIDTH = 1000;
 
 KSMainWindow::KSMainWindow(bool onClickAvailable, QWidget *parent) :
     QDialog(parent),
-    mKSWidget(new KSWidget),
-    mDivider(new QFrame),
-    mDialogButtonBox(new QDialogButtonBox),
-    mConfigureButton(new QToolButton),
-    mToolsButton(new QPushButton),
-    mSendToButton(new QPushButton),
-    mClipboardButton(new QToolButton),
-    mSaveButton(new QToolButton),
-    mSaveMenu(new QMenu),
+    mKSWidget(new KSWidget(this)),
+    mDivider(new QFrame(this)),
+    mDialogButtonBox(new QDialogButtonBox(this)),
+    mConfigureButton(new QToolButton(this)),
+    mToolsButton(new QPushButton(this)),
+    mSendToButton(new QPushButton(this)),
+    mClipboardButton(new QToolButton(this)),
+    mSaveButton(new QToolButton(this)),
+    mSaveMenu(new QMenu(this)),
     mSaveAsAction(new QAction(this)),
     mSaveAction(new QAction(this)),
-    mMessageWidget(new KMessageWidget),
-    mToolsMenu(new QMenu),
-    mScreenRecorderToolsMenu(new QMenu),
+    mMessageWidget(new KMessageWidget(this)),
+    mToolsMenu(new QMenu(this)),
+    mScreenRecorderToolsMenu(new QMenu(this)),
     mExportMenu(new ExportMenu(this)),
     mOnClickAvailable(onClickAvailable)
 {
@@ -172,7 +172,9 @@ void KSMainWindow::init()
     mScreenRecorderToolsMenu = mToolsMenu->addMenu(i18n("Record Screen"));
     connect(mScreenRecorderToolsMenu, &QMenu::aboutToShow, [this]()
     {
-        mScreenrecorderToolsMenuFactory.reset(new KMoreToolsMenuFactory(QStringLiteral("spectacle/screenrecorder-tools")));
+        KMoreToolsMenuFactory *moreToolsMenuFactory = new KMoreToolsMenuFactory(QStringLiteral("spectacle/screenrecorder-tools"));
+        moreToolsMenuFactory->setParentWidget(this);
+        mScreenrecorderToolsMenuFactory.reset(moreToolsMenuFactory);
         mScreenRecorderToolsMenu->clear();
         mScreenrecorderToolsMenuFactory->fillMenuFromGroupingNames(mScreenRecorderToolsMenu, { QStringLiteral("screenrecorder") });
     } );
-- 
cgit v1.1

